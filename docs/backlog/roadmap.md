# ロードマップ

## ビジョン

**最終目標**: 法人向けCASB（Cloud Access Security Broker）
- AIサービスの利用状況を可視化し、プライバシーリスクを管理
- 端末完結型（サーバーレス）のブラウザ拡張機能
- プライバシー保護（データは端末に留まる）
- 「検出→可視化→ポリシー生成」のフロー

## Phase 1: MVP強化 ✅ 完了

**目標**: 個人ユーザー向け価値検証

### 実装済み
- サービス検出（ログインページ、認証）
- CSP監査
- AIプロンプト監視（基本）
- PII検出（プロンプト内の個人情報検出）
- リスクスコアリング（AIプロンプトの機密性レベル自動評価）
- エクスポート機能（監査ログのCSV/JSON出力）

## Phase 2: 可視化強化 ✅ 完了

**目標**: データドリブンな意思決定支援

### 実装済み
| 機能 | 説明 | PR |
|-----|------|-----|
| ダッシュボード改善 | 時系列分析、トレンド表示、ヒートマップ | #49 |
| Shadow AI検出強化 | 17+プロバイダー自動分類（OpenAI, Anthropic, Google, Azure, DeepSeek等） | #50 |
| 拡張機能リスク監視 | パーミッション分析、ネットワーク活動監視、リスクスコア算出 | #51 |
| Identity Security | パスワード強度分析、SHA-256ハッシュベースの再利用検出 | #52 |

## Phase 3: ポリシーエンジン ✅ 完了

**目標**: 検出から保護へ

### 実装済み
| 機能 | 説明 | PR |
|-----|------|-----|
| アラート機能 | NRD、Typosquat、Shadow AI、Extension、AI Sensitiveアラート | Phase 1-2 |
| DLPルール | APIキー（Google, Stripe, Slack, JWT等）、日本固有パターン（マイナンバー等） | #53 |
| ポリシー自動生成 | 検出データからセキュリティポリシー自動提案 | #53 |
| ローカルブロック | ユーザー同意ベース、タイポスクワット/NRDログイン/機密データ送信ブロック | #54 |

## Phase 4: エンタープライズ対応

**目標**: 法人向けCASBへの進化

### 実装済み（ローカル完結） ✅ 完了
| 機能 | 説明 | PR |
|-----|------|-----|
| ブロック設定UI | 設定メニューに保護機能トグルと同意ダイアログ追加 | #56 |
| Firefox対応 | Firefox MV2ビルドサポート、ブラウザ別manifest設定 | #57 |
| Edge対応 | Edge MV3ビルドサポート（WXT標準機能） | #70 |
| Safari対応 | Safari MV2ビルドサポート | #60 |
| Data Exfiltration検出 | 大量データ転送検出（100KB+）、fetch/XHR/beacon監視 | #62 |
| Credential Theft検出 | フォーム送信監視、非HTTPS/クロスオリジン検出 | #63 |
| Supply Chain検出 | 外部スクリプト監視、SRI検証、CDN検出 | #64 |
| Compliance検出 | クッキーポリシー/バナー検出、GDPR準拠チェック | #65 |
| Policy Enforcement | ドメイン/ツール/AI/データ転送ポリシールール | #66, #67, #68 |

### 実装済み（オプトイン機能） ✅ 完了
| 機能 | 説明 | PR |
|-----|------|-----|
| オプショナルサーバー連携 | 組織での一元管理（ユーザー同意ベース） | #81 |
| プライバシーポリシー | オプトイン外部通信の説明ドキュメント | #81 |
| SSO統合 | SAML/OIDC認証対応（トークンはローカル保存） | #82 |
| コンプライアンスレポート | HIPAA/CCPA/GDPR/SOC2対応（ローカル生成） | #83 |

### 実装済み（ローカル分析） ✅ 完了
| 機能 | 説明 | PR |
|-----|------|-----|
| AI利用パターン分析 | 組織全体のAI使用トレンド・異常検知（ローカル完結） | #84 |
| リスクベンチマーク | 業界別・規模別ベンチマーク比較（ローカルDB） | #85 |

### 未実装（外部サーバー連携が必要）
**注意**: 以下の機能は外部サーバー連携を含むため、ユーザー同意が必要。

| 機能 | 説明 | 優先度 |
|-----|------|-------|

## Phase 5: インテリジェンス

**目標**: 高度な分析機能

### 実装済み（ローカル完結） ✅ 完了
| 機能 | 説明 | PR |
|-----|------|-----|
| 軽量脅威DB | バンドル形式の脅威インテリジェンス（高リスクTLD、フィッシングパターン） | #58 |
| 脅威DB統合 | typosquat検出との統合、threat_intel_matchイベント | #59 |
| 予測分析 | トレンド検出、異常検知、リスク予測（ローカル完結） | #60 |
| 予測分析UI | TimelineTabにリスク予測セクション、警告表示 | #61 |

### 未実装（外部サーバー連携が必要）
| 機能 | 説明 | 優先度 |
|-----|------|-------|
| AI利用パターン分析 | 組織全体の傾向 | 中 |
| リスクベンチマーク | 業界平均との比較 | 低 |

## Phase 6: プロダクション品質化 ✅ 完了

**目標**: UX改善・パフォーマンス最適化

### 実装済み（ローカル完結）
| 機能 | 説明 | 優先度 | PR |
|-----|------|-------|-----|
| スケルトンローダー | ダッシュボード初期ロード時の骨組みアニメーション | 高 | #70 |
| リアルタイム通知 | 脅威検出時のスライドイン通知バナー | 高 | #70 |
| エラーメッセージ改善 | ユーザーフレンドリーなエラー表示 | 高 | #70 |
| 仮想スクローリング | 大量データ表示時のパフォーマンス改善（VirtualList/VirtualTable） | 中 | #71 |
| ディープリンク | URL経由でのタブ・フィルター状態共有（useDeepLinkフック） | 中 | #71 |
| キーボードナビゲーション | 全タブでのキーボード操作対応（useKeyboardNavフック） | 中 | #71 |

## Phase 7: テスト基盤整備 ✅ 完了

**目標**: コード品質の担保とリグレッション防止

### 実装済み（ローカル完結）
| 機能 | 説明 | 優先度 | PR |
|-----|------|-------|-----|
| Vitestセットアップ | テストフレームワーク導入、vitest.config.ts | 高 | #72 |
| NRD検出テスト | suspicious.test.ts (29テスト) | 高 | #72 |
| Typosquat検出テスト | heuristics.test.ts (26テスト) | 高 | #72 |

| AIプロバイダー分類テスト | 17+プロバイダーの分類精度テスト (33テスト) | 高 | #73 |
| PII検出テスト | 機密データ検出の精度テスト (49テスト) | 高 | #73 |
| DLPルールテスト | DLPパターン・マネージャーテスト (34テスト) | 高 | #74 |

| UIコンポーネントテスト | Badge, Button, StatCard, Card, Select, EmptyState, Skeleton, LoadingState, ErrorStateのテスト (89テスト) | 中 | #75, #78 |
| Policy Engineテスト | ポリシーエンジンの条件評価・違反管理テスト (35テスト) | 高 | #70 |
| Blocking Engineテスト | ブロッキングエンジンの判定・イベント管理テスト (33テスト) | 高 | #70 |
| Threat Intelテスト | 脅威インテリジェンス分析テスト (41テスト) | 高 | #70 |
| Predictive Analysisテスト | トレンド検出・異常検知テスト (23テスト) | 高 | #70 |
| Identity Securityテスト | パスワード強度分析テスト (49テスト) | 高 | #70 |
| Data Exportテスト | CSV/JSON/Markdown/HTMLエクスポートテスト (38テスト) | 中 | #70 |
| CSP Analyzerテスト | CSPポリシー生成・統計・推奨事項テスト (27テスト) | 高 | #70 |
| Alert Managerテスト | アラート管理・通知・ライフサイクルテスト (48テスト) | 高 | #70 |
| Policy Generatorテスト | ポリシー自動生成テスト (27テスト) | 高 | #70 |
| Password Reuse Detectorテスト | パスワード再利用検出テスト (28テスト) | 高 | #70 |
| Extension Risk Analyzerテスト | 拡張機能リスク分析テスト (48テスト) | 高 | #70 |
| Risk Forecasterテスト | リスク予測テスト (24テスト) | 高 | #70 |
| Login Detectorテスト | ログイン検出テスト (31テスト) | 高 | #70 |
| Privacy Finderテスト | プライバシーポリシー検出テスト (33テスト) | 高 | #70 |
| NRD Detectorテスト | NRD検出器テスト (19テスト) | 高 | #70 |
| DDNSテスト | DDNS検出テスト (36テスト) | 高 | #70 |
| RDAPテスト | RDAP APIクライアントテスト (14テスト) | 高 | #70 |
| ToS Finderテスト | 利用規約検出テスト (32テスト) | 高 | #70 |
| Cookie Finderテスト | クッキーポリシー・バナー検出テスト (35テスト) | 高 | #70 |
| Typosquat Detectorテスト | タイポスクワッティング検出器テスト (22テスト) | 高 | #70 |
| URL Utilsテスト | URL解析ユーティリティテスト (33テスト) | 高 | #70 |
| Patternsテスト | パターンマッチングヘルパーテスト (147テスト) | 高 | #70 |
| AI Detectorテスト | AIリクエスト/レスポンス検出テスト (45テスト) | 高 | #70 |
| Sensitive Data Detectorテスト | 機密データ検出テスト (49テスト) | 高 | #70 |
| Favicon Detectorテスト | ファビコン検出テスト (26テスト) | 中 | #70 |
| Report Generatorテスト | コンプライアンスレポート生成テスト (31テスト) | 高 | #70 |
| Policy Managerテスト | ポリシー管理・違反検出テスト (54テスト) | 高 | #70 |
| Permission Analyzerテスト | 拡張機能権限分析テスト (31テスト) | 高 | #70 |
| Risk Prioritizerテスト | リスク優先順位付けテスト (48テスト) | 高 | #70 |
| Policy Finder Baseテスト | ポリシー検出基盤テスト (28テスト) | 高 | #70 |
| Runtime Protectionテスト | ランタイム保護・脅威検出テスト (25テスト) | 高 | #70 |
| Risk Calculatorテスト | リスクスコア計算テスト (46テスト) | 高 | #70 |
| Audit Exporterテスト | CSV/JSON監査ログエクスポートテスト (38テスト) | 中 | #70 |
| Graph Builderテスト | セキュリティグラフ構築テスト (49テスト) | 高 | #70 |
| Threat Dataテスト | 脅威インテリジェンスデータテスト (36テスト) | 中 | #70 |
| CSP Constantsテスト | CSPディレクティブ定数テスト (33テスト) | 中 | #70 |
| Loggerテスト | ロガーユーティリティテスト (38テスト) | 中 | #70 |
| SQL.js Adapterテスト | データベースアダプターテスト (28テスト) | 高 | #70 |
| API Routesテスト | Honoルーティング・エンドポイントテスト (32テスト) | 高 | #70 |
| Parquet Schemaテスト | データ変換・スキーマ定義テスト (59テスト) | 高 | #70 |
| Query Engineテスト | クエリエンジン・フィルタリング・ページネーションテスト (38テスト) | 高 | #70 |
| Integration Managerテスト | 統合管理・ワークフロー・トリガー条件テスト (41テスト) | 高 | #70 |
| Write Bufferテスト | バッファリング・フラッシュ・デバウンステスト (30テスト) | 中 | #70 |
| Dynamic Indexテスト | インデックスキャッシュ・ビルダーテスト (22テスト) | 中 | #70 |
| Sensitive Data Detectorテスト | 機密データ検出・分類・マスキングテスト (47テスト) | 高 | #70 |
| API Clientテスト | リモート/ローカルモード・API呼び出しテスト (20テスト) | 高 | #72 |
| Sync Managerテスト | 同期管理・アラーム・双方向同期テスト (20テスト) | 高 | #73 |
| Migrationテスト | マイグレーション・バッチ処理テスト (13テスト) | 高 | #73 |
| Storageテスト | ストレージ操作・キュー処理テスト (20テスト) | 高 | #74 |
| Parquet Storeテスト | データ永続化・クエリ・削除テスト (17テスト) | 高 | #76 |
| Storage Event Storeテスト | IndexedDBスキーマ・イベントストア・マイグレーションテスト (50テスト) | 高 | #79 |
| Browser Adapterテスト | DOM操作アダプターテスト (10テスト) | 中 | #79 |
| Message Handlerテスト | メッセージルーター・fireAndForgetテスト (13テスト) | 中 | #79 |

### テスト統計
- **パッケージテスト**: 2080テスト / 64ファイル
- **拡張機能テスト**: 89テスト / 9ファイル
- **総テスト数**: 2169テスト / 73ファイル
- **カバレッジ**: 主要パッケージ全て、UIコンポーネント

## 成功指標

| Phase | KPI | 状態 |
|-------|-----|------|
| Phase 1 | 週間アクティブユーザー 100人 | 検証中 |
| Phase 2 | ユーザー維持率 40% | 検証中 |
| Phase 3 | 有料化検討可能なフィードバック収集 | 検証中 |
| Phase 4 | 初期法人顧客 5社 | 未着手 |
| Phase 5 | ARR達成 | 未着手 |

## リスクと対策

| リスク | 対策 |
|-------|------|
| ローカル完結の限界 | Phase 4でオプショナルサーバー連携 |
| Manifest V3制限 | WXT採用で対応済み |
| 競合の追随 | OSSとプライバシーで差別化維持 |
| サプライチェーン攻撃 | コード署名、リリース監査強化 |

## 新規パッケージ（Phase 1-5で追加）

| パッケージ | 説明 |
|-----------|------|
| `@pleno-audit/identity-security` | パスワード強度/再利用検出 |
| `@pleno-audit/data-export` | 監査ログエクスポート |
| `@pleno-audit/threat-intel` | バンドル形式の軽量脅威DB |
| `@pleno-audit/predictive-analysis` | ローカル予測分析（トレンド検出、異常検知） |

## 主要な追加ファイル

| ファイル | 説明 |
|---------|------|
| `packages/ai-detector/src/provider-classifier.ts` | Shadow AI検出（17+プロバイダー） |
| `packages/ai-detector/src/dlp-rules.ts` | DLPルール管理 |
| `packages/ai-detector/src/policy-generator.ts` | ポリシー自動生成 |
| `packages/extension-runtime/src/extension-risk-analyzer.ts` | 拡張機能リスク分析 |
| `packages/extension-runtime/src/blocking-engine.ts` | ローカルブロックエンジン |
| `app/extension/components/TimelineChart.tsx` | 時系列チャート |
| `app/extension/entrypoints/dashboard/TimelineTab.tsx` | タイムラインタブ |
