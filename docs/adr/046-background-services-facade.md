# ADR 046: Background Servicesのファサード構造化

## ステータス

Accepted

## コンテキスト

- `createBackgroundServices` が全サービスの関数をフラットに返すため、呼び出し側が大量の関数を個別に展開している
- `background.ts` の依存関係が拡散し、責務境界が読み取りづらい
- サービス追加・削除時に差分が広がり、影響範囲の把握が難しい

## 決定

- Background Servicesをドメイン別のファサード (`api`, `sync`, `events`, `alerts`, `storage`, `analysis`, `config`, `utils`) として提供する
- 呼び出し側はドメイン単位で依存を受け取り、関心ごとを明示する
- 外部の機能・振る舞いは維持し、内部構造のみを再編する

## 理由

- 可読性: 関心ごとのまとまりを示し、背景の依存関係を追いやすくする
- 変更容易性: 新機能追加時の差分をファサード単位に局所化できる
- リスク低減: 公開APIを温存しつつ、内部実装の整理で安全に移行できる

## リスクと対応

| リスク | 対応 |
|--------|------|
| 依存の取りこぼしによる機能劣化 | 既存関数を全てファサードに割り当て、実動作で確認する |
| 呼び出し側の更新漏れ | 型エラーと一括リネームで置換し、レビューで確認する |
| ドメイン境界の不一致 | `config`/`sync` の責務は明確化し、必要に応じて再配置する |
