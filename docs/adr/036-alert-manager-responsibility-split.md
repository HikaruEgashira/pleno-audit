# ADR 036: Alert Managerの責務分離

## ステータス

Accepted

## コンテキスト

- `packages/alerts/src/alert-manager.ts` はアラート生成ロジックとライフサイクル管理を同一ファイルで扱う
- カテゴリごとの文言生成・重大度判定・詳細データ組み立てが混在し、変更時の影響範囲が広い
- 追加カテゴリ実装時に既存ロジックとの干渉が起きやすく、可読性と凝集度が低下する

## 決定

- アラートカテゴリ固有の生成ロジックを `packages/alerts/src/alert-builders.ts` に分離する
- `createAlertManager` は保存・購読通知・状態遷移に責務を限定する
- 既存の公開API（メソッド名、引数、戻り値）と既定の挙動は維持する

## 理由

- 可読性: 生成ロジックを pure function 群として切り出すことで追跡単位を小さくできる
- 凝集度: 文言/重大度判定の関心事を1箇所に集約し、Alert Managerをオーケストレーション層に保てる
- 変更容易性: 新規カテゴリ追加時に builder 追加で完結しやすく、既存メソッドへの副作用を抑えられる
- パフォーマンス: 生成処理の重複分岐を減らし、メンテナンス時の不要な条件評価増加を防げる

## リスクと対応

| リスク | 対応 |
|--------|------|
| リファクタ時に文言や重大度が変化する | 既存判定ロジックをbuilderへ等価移植し、既存テストと実動作確認で互換性を確認する |
| 既定アクション選択の挙動差分が出る | ルール解決順序とフォールバック動作を維持し、Alert Manager側で一元管理する |
