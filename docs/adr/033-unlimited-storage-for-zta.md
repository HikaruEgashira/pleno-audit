# ADR 033: ZTA監査証跡のためのunlimitedStorage採用

## ステータス

Accepted

## コンテキスト

### 背景
- 拡張機能ネットワーク監視（DNR）は他の拡張機能の通信を記録する
- 従来は`maxStoredRequests`（デフォルト5,000件）で保存件数を制限していた
- ZTA（ゼロトラストアーキテクチャ）の原則では、すべての通信を記録・監査可能にすることが求められる

### 問題
| 観点 | 件数制限あり | 件数制限なし |
|------|-------------|-------------|
| 監査証跡 | 古いログ消失 | 完全な履歴 |
| インシデント調査 | 過去データ不足 | 遡及可能 |
| パターン分析 | 限定的 | 長期傾向分析可能 |

### ストレージ制限
- Chrome拡張のデフォルト: 10MB
- `unlimitedStorage`権限: 無制限

## 決定

### 採用する方針
1. `unlimitedStorage`権限を追加する
2. `maxStoredRequests`のUI設定を削除する
3. 監視データは無制限に保存する

### 実装
- `wxt.config.ts`の`basePermissions`に`unlimitedStorage`を追加
- DNRSettings.tsxからスライダーUIを削除
- debugger CLIから`--max-requests`オプションを削除

## 理由

- **ZTA準拠**: すべての拡張機能通信を記録し、監査証跡を完全に保持する
- **インシデント対応**: 過去の異常通信を遡って調査可能にする
- **シンプル化**: ユーザーがストレージ管理を意識する必要がなくなる

## リスクと対応

| リスク | 対応 |
|--------|------|
| ストレージ肥大化 | 将来的に時間ベースの保持ポリシー（retentionDays）を検討 |
| パフォーマンス低下 | 必要に応じてインデックス最適化を実施 |

## 関連

- PR #225: DNR設定UI追加
