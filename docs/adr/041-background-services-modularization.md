# ADR-041: Backgroundサービス責務のモジュール分割

## ステータス
採用

## コンテキスト
Background entrypointに検出・ストレージ・DoH監視・データ保持・イベント記録など複数の責務が集中しており、
変更容易性と可読性が低下している。

## 決定
Backgroundの主要責務をサービス単位に分割し、entrypointは依存関係の配線とオーケストレーションに専念する。
具体的には、イベント記録、ストレージアクセス、サービス更新、リスク検出、DoH監視、データ保持を個別モジュールに分離する。

## 理由
- 可読性: 責務単位で整理され、見通しが改善する。
- 変更容易性: 機能ごとの変更が局所化される。
- 凝集度: データ保持・検出・監視の関心を分離できる。

## トレードオフ
- モジュール数が増え、依存関係の配線が増える。
- 初期追跡コストが増える。

## リスクと対応
- リスク: 依存関係の引き渡し漏れで動作が変わる。
- 対応（軽減）: 既存の入出力を保持し、動作確認でエンドツーエンドの挙動を検証する。
