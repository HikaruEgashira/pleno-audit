# ADR 047: SSOユーティリティを分割して責務を明確化する

## ステータス

Accepted

## コンテキスト

- `sso-manager` がOIDC/SAMLの実装詳細、ユーティリティ、型定義まで単一ファイルに集約されている
- セキュリティ関連ロジックのテストが本体から乖離しやすく、変更影響の追跡が難しい
- SSO関連の再利用性と可読性を高めつつ、公開APIの互換性を維持したい

## 決定

- SSOの型定義を `sso-types` に分離する
- PKCE/JWT/SAMLの共通ユーティリティを `sso-utils` に集約する
- OIDC/SAMLのフロー処理を `sso-oidc` / `sso-saml` に分割する
- `sso-manager` の公開APIは維持し、利用側の機能差分を発生させない

## 理由

- 見通し: 認証フローとユーティリティの境界を明確にできる
- 保守性: セキュリティロジックを集中させ、テストの再利用と変更影響を局所化できる
- 互換性: 既存の呼び出し元を変更せずに内部構造を改善できる

## リスクと対応

| リスク | 対応 |
|--------|------|
| ファイル分割による import の増加 | 型定義とユーティリティを単一の基盤モジュールに集約する |
| ログ出力の差異 | 既存のログ内容を引き継ぎ、出力ポイントを同一にする |
| 動作差異の混入 | 公開APIの戻り値・エラーハンドリングを維持し、拡張の実動作で確認する |
