# ADR 047: Debug Bridgeのハンドラ構成をモジュール分割する

## ステータス

Accepted

## コンテキスト

- `debug-bridge` がWebSocket接続、ログ転送、ストレージ/イベント/ネットワーク操作など複数の責務を単一ファイルで担っている
- 追加のデバッグ機能が増えるたびにスイッチ文が肥大化し、影響範囲の把握が難しくなる
- デバッグ周りの変更は挙動差異を避けたい一方、構造整理による安全な拡張性が必要

## 決定

- `debug-bridge` を接続制御とハンドラ登録に集中させ、操作系ロジックをモジュールに分割する
- 既存のメッセージ型・レスポンス構造・挙動は維持し、公開APIは `initDebugBridge` のみとする

## 理由

- 見通し: 操作単位で責務を分離し、レビュー範囲を局所化できる
- 安全性: 既存の通信プロトコルを守りつつ、変更点を限定できる
- 拡張容易性: 新しいデバッグ操作を既存モジュールの追加で完結できる

## リスクと対応

| リスク | 対応 |
|--------|------|
| 分割に伴う参照漏れ | `handlers` の集中登録で抜け漏れを検出する |
| バンドルパスの不整合 | `debug-bridge.ts` を互換エントリとして維持する |
| 動作差異の混入 | 既存の実動作手順でデバッグ接続を検証する |
